CREATE OR REPLACE VIEW `reclamos_sernac.vista_semestral_consolidada` AS

WITH T1 AS (
SELECT *
FROM `reclamos_sernac.enero_satisfaccion`
UNION ALL
SELECT *
FROM `reclamos_sernac.febrero_satisfaccion`
UNION ALL
SELECT *
FROM `reclamos_sernac.marzo_satisfaccion`
UNION ALL
SELECT *
FROM `reclamos_sernac.abril_satisfaccion`
UNION ALL
SELECT *
FROM `reclamos_sernac.mayo_satisfaccion`
UNION ALL
SELECT *
FROM `reclamos_sernac.junio_satisfaccion`
)

SELECT
id,
date(fecha_inicio) as Fecha,
pex as Experiencia,
nps as NPS,
gen as Genero,
region as Region,
educ as Educacion,
edad as Edad,

-- Jerarquia a Ingresos
case
when ingreso = 'Menos de $300.000' then '1) Menos de $300.000'
when ingreso = 'Entre $300.001 y $399.999' then '2) Entre $300.001 y $399.999'
when ingreso = 'Entre $400.000 y $599.999' then '3) Entre $400.000 y $599.999'
when ingreso = 'Entre $600.000 y $1.099.000' then '4) Entre $600.000 y $1.099.000'
else '5) $1.100.000 o mÃ¡s'
end as GrupoIngreso,

-- Categoria NPS
case
when nps >= 9 then 'Promotor'
when nps <= 6 then 'Detractor'
else 'Indiferente'
end as CategoriaNPS,

-- Flag Inconsistencia
case
when nps >= 9 and pex <= 3 then 1
when nps <= 6 and pex >= 5 then 1
else 0
end as FlagInconsist

FROM T1
